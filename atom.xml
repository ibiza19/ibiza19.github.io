<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>ibiza19&#39;s Studio.</title>
  
  
  <link href="/atom.xml" rel="self"/>
  
  <link href="https://ibiza19.top/"/>
  <updated>2023-06-04T09:12:00.580Z</updated>
  <id>https://ibiza19.top/</id>
  
  <author>
    <name>ibiza19</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>C语言最基本的套接字编程</title>
    <link href="https://ibiza19.top/2023/06/a003d54c5348.html"/>
    <id>https://ibiza19.top/2023/06/a003d54c5348.html</id>
    <published>2023-06-04T08:53:27.000Z</published>
    <updated>2023-06-04T09:12:00.580Z</updated>
    
    <content type="html"><![CDATA[<h1 id="套接字是啥"><a href="#套接字是啥" class="headerlink" title="套接字是啥"></a>套接字是啥</h1><p>套接字（socket）就是用来连接网络的工具</p><p>套接字可以比喻成电话机</p><ul><li>socket — 买一个电话机☎️</li><li>bind — 分配电话号码（分配IP地址和端口号）</li><li>listen — 连接电话线（将连接转换为可接听状态）</li><li>accept — 拿起话筒接听（受理连接请求）</li></ul><h2 id="一个简单的服务端程序"><a href="#一个简单的服务端程序" class="headerlink" title="一个简单的服务端程序"></a>一个简单的服务端程序</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// hello_server.c</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;arpa/inet.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/socket.h&gt;</span></span></span><br><span class="line"><span class="type">void</span> <span class="title function_">error_handling</span><span class="params">(<span class="type">char</span> *message)</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span> *argv[])</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">int</span> serv_sock;</span><br><span class="line">    <span class="type">int</span> clnt_sock;</span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">sockaddr_in</span> <span class="title">serv_addr</span>;</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">sockaddr_in</span> <span class="title">clnt_addr</span>;</span></span><br><span class="line">    <span class="type">socklen_t</span> clnt_addr_size;</span><br><span class="line"></span><br><span class="line">    <span class="type">char</span> message[] = <span class="string">&quot;Hello world&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (argc != <span class="number">2</span>) &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;Usage: %s &lt;port&gt;\n&quot;</span>, argv[<span class="number">0</span>]);</span><br><span class="line">        <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    serv_sock = socket(PF_INET, SOCK_STREAM, <span class="number">0</span>);</span><br><span class="line">    <span class="keyword">if</span> (serv_sock == <span class="number">-1</span>) &#123;</span><br><span class="line">        error_handling(<span class="string">&quot;socket() error&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">memset</span>(&amp;serv_addr, <span class="number">0</span>, <span class="keyword">sizeof</span>(serv_addr));</span><br><span class="line">    serv_addr.sin_family = AF_INET;</span><br><span class="line">    serv_addr.sin_addr.s_addr = htonl(INADDR_ANY);</span><br><span class="line">    serv_addr.sin_port = htons(atoi(argv[<span class="number">1</span>]));</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (bind(serv_sock, (<span class="keyword">struct</span> sockaddr*) &amp;serv_addr, <span class="keyword">sizeof</span>(serv_addr)) == <span class="number">-1</span>) &#123;</span><br><span class="line">        error_handling(<span class="string">&quot;bind() error&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (listen(serv_sock, <span class="number">5</span>) == <span class="number">-1</span>) &#123;</span><br><span class="line">        error_handling(<span class="string">&quot;listen() error&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    clnt_addr_size = <span class="keyword">sizeof</span>(clnt_addr);</span><br><span class="line">    clnt_sock = accept(serv_sock, (<span class="keyword">struct</span> sockaddr*) &amp;clnt_addr, &amp;clnt_addr_size);</span><br><span class="line">    <span class="keyword">if</span> (clnt_sock == <span class="number">-1</span>) &#123;</span><br><span class="line">        error_handling(<span class="string">&quot;accept() error&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    write(clnt_sock, message, <span class="keyword">sizeof</span>(message));</span><br><span class="line">    close(clnt_sock);</span><br><span class="line">    close(serv_sock);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">error_handling</span><span class="params">(<span class="type">char</span> *message)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">fputs</span>(message, <span class="built_in">stderr</span>);</span><br><span class="line">    fputc(<span class="string">&#x27;\n&#x27;</span>, <span class="built_in">stderr</span>);</span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>收到连接请求，给”Hello world”回应</p><p>会在 <code>clnt_sock = accept(serv_sock, (struct sockaddr*) &amp;clnt_addr, &amp;clnt_addr_size);</code>这里阻塞，等待有链接进来</p><h2 id="一个简单的客户端"><a href="#一个简单的客户端" class="headerlink" title="一个简单的客户端"></a>一个简单的客户端</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;arpa/inet.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/socket.h&gt;</span></span></span><br><span class="line"><span class="type">void</span> <span class="title function_">error_handling</span><span class="params">(<span class="type">char</span> *message)</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span> *argv[])</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">int</span> sock;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">sockaddr_in</span> <span class="title">serv_addr</span>;</span></span><br><span class="line">    <span class="type">char</span> message[<span class="number">30</span>];</span><br><span class="line">    <span class="type">int</span> str_len;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (argc != <span class="number">3</span>) &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;Usage: %s &lt;IP&gt; &lt;port&gt;\n&quot;</span>, argv[<span class="number">0</span>]);</span><br><span class="line">        <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    sock = socket(PF_INET, SOCK_STREAM, <span class="number">0</span>);</span><br><span class="line">    <span class="keyword">if</span> (sock == <span class="number">-1</span>) &#123;</span><br><span class="line">        error_handling(<span class="string">&quot;socket() error&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">memset</span>(&amp;serv_addr, <span class="number">0</span>, <span class="keyword">sizeof</span>(serv_addr));</span><br><span class="line">    serv_addr.sin_family = AF_INET;</span><br><span class="line">    serv_addr.sin_addr.s_addr = inet_addr(argv[<span class="number">1</span>]);</span><br><span class="line">    serv_addr.sin_port = htons(atoi(argv[<span class="number">2</span>]));</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (connect(sock, (<span class="keyword">struct</span> sockaddr*) &amp;serv_addr, <span class="keyword">sizeof</span>(serv_addr)) == <span class="number">-1</span>) &#123;</span><br><span class="line">        error_handling(<span class="string">&quot;connect() error&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    str_len = read(sock, message, <span class="keyword">sizeof</span>(message) - <span class="number">1</span>);</span><br><span class="line">    <span class="keyword">if</span> (str_len == <span class="number">-1</span>) &#123;</span><br><span class="line">        error_handling(<span class="string">&quot;read() error!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Message from server : %s \n&quot;</span>, message);</span><br><span class="line">    close(sock);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">error_handling</span><span class="params">(<span class="type">char</span> *message)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">fputs</span>(message, <span class="built_in">stderr</span>);</span><br><span class="line">    fputc(<span class="string">&#x27;\n&#x27;</span>, <span class="built_in">stderr</span>);</span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>调用<code>connect</code>函数向服务端发出请求</p><h2 id="运行结果"><a href="#运行结果" class="headerlink" title="运行结果"></a>运行结果</h2><p><img src="https://s2.loli.net/2023/06/04/6z7G1fHYsBOy5nA.webp" alt="image.png"></p><h1 id="套接字与文件操作"><a href="#套接字与文件操作" class="headerlink" title="套接字与文件操作"></a>套接字与文件操作</h1><p>实际上，在Linux里面socket也被认为是文件的一种</p><p>已经分配的文件描述符和文件打开模式：</p><p><img src="https://s2.loli.net/2023/06/04/G3udLaHfMeK5ryW.webp" alt="image.png"><br><img src="https://s2.loli.net/2023/06/04/hYg2FqWy35wHBNI.webp" alt="image.png"></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;fcntl.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/socket.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">int</span> fd1, fd2, fd3;</span><br><span class="line">    fd1 = socket(PF_INET, SOCK_STREAM, <span class="number">0</span>);</span><br><span class="line">    fd2 = open(<span class="string">&quot;test.dat&quot;</span>, O_CREAT | O_WRONLY | O_TRUNC);</span><br><span class="line">    fd3 = socket(PF_INET, SOCK_DGRAM, <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;file descriptor 1: %d\n&quot;</span>, fd1);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;file descriptor 2: %d\n&quot;</span>, fd2);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;file descriptor 3: %d\n&quot;</span>, fd3);</span><br><span class="line"></span><br><span class="line">    close(fd1);</span><br><span class="line">    close(fd2);</span><br><span class="line">    close(fd3);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>结果：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">▶ ./fds  </span><br><span class="line">file descriptor 1: 3</span><br><span class="line">file descriptor 2: 4</span><br><span class="line">file descriptor 3: 5</span><br></pre></td></tr></table></figure><p>除去系统占用的0 1 2，说明socket也是文件描述符，而且编号顺序是从小到大的</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;套接字是啥&quot;&gt;&lt;a href=&quot;#套接字是啥&quot; class=&quot;headerlink&quot; title=&quot;套接字是啥&quot;&gt;&lt;/a&gt;套接字是啥&lt;/h1&gt;&lt;p&gt;套接字（socket）就是用来连接网络的工具&lt;/p&gt;
&lt;p&gt;套接字可以比喻成电话机&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;soc
      
    
    </summary>
    
      <category term="计算机网络" scheme="https://ibiza19.top/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/"/>
    
    
  </entry>
  
  <entry>
    <title>Hexo + Obsidian + Git + Cloudflare 实现便利博客部署和编辑方案</title>
    <link href="https://ibiza19.top/2023/05/a1787e13963d.html"/>
    <id>https://ibiza19.top/2023/05/a1787e13963d.html</id>
    <published>2023-05-31T04:20:39.000Z</published>
    <updated>2023-06-04T09:12:00.580Z</updated>
    
    <content type="html"><![CDATA[<h1 id="使用Hexo搭建博客"><a href="#使用Hexo搭建博客" class="headerlink" title="使用Hexo搭建博客"></a>使用Hexo搭建博客</h1><p>参考这篇大佬写的文章：<a href="https://blog.esunr.xyz/2022/06/64163235c30f.html">Hexo 快速搭建指南</a></p><p>注意我们是使用github搭建博客，所以直接跳过那篇文章的第二部分</p><p>主题不用担心，后面改的话是很方便的（主题换的时候注意一定不要从github上面拉，因为生成的.git文件会跟hexo根目录下的冲突，导致主题commit不上去）</p><p><img src="https://s2.loli.net/2023/05/31/Q4lLNr3Gb9uE8ph.webp" alt="image.png"></p><p>Github Action 工作流真的巨赞</p><h1 id="使用Obsidian管理博客"><a href="#使用Obsidian管理博客" class="headerlink" title="使用Obsidian管理博客"></a>使用Obsidian管理博客</h1><p>大体上依旧参考那位大佬的文章：<a href="https://blog.esunr.xyz/2022/07/e9b42b453d9f.html">Hexo + Obsidian + Git 完美的博客部署与编辑方案</a></p><p>但是注意在使用obsidian的时候，可以不用选择hexo根文件夹，使用source也是非常好的。因为文章中的obsidian插件 <code>File Tree Alternative Plugin</code> 已经改版了，<code>Focuse on Folder</code> 变的极其奇怪，所以选用在source目录下使用obsidian</p><p><img src="https://s2.loli.net/2023/05/31/vJi1yCHjk752KFN.webp" alt="image.png"></p><p>iCloud同步个人觉得没必要，直接用Github解决</p><h1 id="自定义域名和开启HTTPS"><a href="#自定义域名和开启HTTPS" class="headerlink" title="自定义域名和开启HTTPS"></a>自定义域名和开启HTTPS</h1><p>参考这位大佬的文章：<a href="https://siriusq.top/github-pages-%E5%90%AF%E7%94%A8-cloudflare-%E5%8A%A0%E9%80%9F%E5%8F%8A-https.html">GitHub Pages 启用 Cloudflare 加速及 HTTPS</a></p><p>需要注意的是当你填写完域名的时候</p><p><img src="https://s2.loli.net/2023/05/31/qKkc5amt6pA9f7l.webp" alt="image.png"></p><p>会自动在release分支里新增一个CNAME文件，这个文件的作用是标识你的域名。但是这个文件在你上传网页的时候自动给覆盖掉，这样在你新上传的时候github就没法知道你的域名，你的网页很可能展示404。为了每一次到release分支都有CNAME文件，你需要把CNAME文件添加到source里面，这样当你新上传的时候github就可以感知的到。</p><p>source文件夹下的最终样子</p><p><img src="https://s2.loli.net/2023/05/31/LKlIWop5Brsanez.webp" alt="image.png"></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;使用Hexo搭建博客&quot;&gt;&lt;a href=&quot;#使用Hexo搭建博客&quot; class=&quot;headerlink&quot; title=&quot;使用Hexo搭建博客&quot;&gt;&lt;/a&gt;使用Hexo搭建博客&lt;/h1&gt;&lt;p&gt;参考这篇大佬写的文章：&lt;a href=&quot;https://blog.esunr
      
    
    </summary>
    
    
  </entry>
  
</feed>
